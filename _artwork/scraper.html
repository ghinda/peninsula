<!doctype html>
<html>
<head>
	<meta charset="utf-8">
	<title>peninsula</title>
	<meta name="description" content="">
</head>
<body>

	
	
	<script>
		var fullProgram;
		
		var i,
			j,
			k,
			l;
		
		var tempProgram;
		
		var day,
			dayNumber,
			dayTime,
			dayWidth,
			artist,
			artistName,
			artistUrl,
			artistStartTime,
			artistEndTime;
		
		var program = {
				main: [],
				freedom: [],
				kiss: [],
				ciuc: [],
				miert: [],
				booha: []
			};
			
		var programMinutes = {
				70: 30,
				140: 60,
				210: 90,
				280: 120
			}
			
		var startDate = [
			// main
			new Date('23 august 2012 17:00'),
			// freedom
			new Date('24 august 2012 21:00')
			
			]
		
		
		var cbfunc = function(response) {
			
			fullProgram = response.query.results.div;

			//
			console.log(fullProgram);
			
			// parse stages
			
			//for(k = 0; k < fullProgram.length; k++) {
			for(k = 0; k < 2; k++) {
				
				tempProgram = fullProgram[k].div.ul;
				
				for(i = 0; i < tempProgram.length; i++) {
					
					day = tempProgram[i].li.div.div;
					dayTime = new Date('23 august 2012 17:00');
					dayTime = new Date(dayTime.setHours(dayTime.getHours() + 24 * i));
					
					for(j = 1; j < day.length; j++) {
					
						artist = day[j];
						dayWidth = parseInt(artist.ul.li.style.replace(/[A-Za-z:$-]/g, ''));
						
						artistName = '';
						if (artist.ul.li.a) {
						
							if(Array.isArray(artist.ul.li.a)) {
							
								//artistName = (artist.ul.li.content) ? artist.ul.li.content : '';
							
								for(l = 0; l < artist.ul.li.a.length; l++) {
									artistName += artist.ul.li.a[l].content;
									
									if(l != artist.ul.li.a.length - 1) artistName += ' & '
								}
							
							} else {
								artistName =  (artist.ul.li.a.strong) ? artist.ul.li.a.strong : artist.ul.li.a.content;
								artistUrl = artist.ul.li.a.href;
							}
						
						} else if (artist.ul.li.strong) {
							
							if(artist.ul.li.strong.a) {
								artistName = artist.ul.li.strong.a.content;
								artistUrl = artist.ul.li.strong.a.href;
							} else {
								artistName = (artist.ul.li.strong.content) ? artist.ul.li.strong.content : artist.ul.li.strong;
								artistUrl = '';
							}
						}
						
						artistName = artistName.toString();
						
						if(artistName) artistStartTime = new Date(dayTime);
						
						dayTime = new Date(dayTime.setMinutes(dayTime.getMinutes() + programMinutes[dayWidth]));
						
						if(artistName) artistEndTime = new Date(dayTime);

						//console.log(artist);
						console.log(artistName);
						//console.log(artistStartTime);
						
						// TODO writefile
						
					}
					
				}
				
			}
			
			// parse freedom arena
			/*
			program.freedom = fullProgram[1].div.ul;
			
			for(i = 0; i < program.freedom.length; i++) {
				
				day = program.freedom[i].li.div.div;
				dayTime = new Date('');
				dayTime = new Date(dayTime.setHours(dayTime.getHours() + 24 * i));
				
				for(j = 1; j < day.length; j++) {
				
					artist = day[j];
					dayWidth = parseInt(artist.ul.li.style.replace(/[A-Za-z:$-]/g, ''));
					
					artistName = false;
					if (artist.ul.li.a) {
						artistName =  artist.ul.li.a.strong;
						artistUrl = artist.ul.li.a.href;
					} else if (artist.ul.li.strong) {
						artistName =  artist.ul.li.strong.a.content;
						artistUrl = artist.ul.li.strong.a.href;
					}
					
					if(artistName) artistStartTime = new Date(dayTime);
					
					dayTime = new Date(dayTime.setMinutes(dayTime.getMinutes() + programMinutes[dayWidth]));
					
					if(artistName) artistEndTime = new Date(dayTime);

					//console.log(artist);
					console.log(artistName);
					console.log(artistStartTime);
					
					// TODO writefile
					
				}
				
			}
			
			*/
			
			
			
			
		}
		
	</script>
	
	<script src="http://query.yahooapis.com/v1/public/yql?q=SELECT%20*%20FROM%20html%20WHERE%20url%20%3D%20'http%3A%2F%2Fwww.peninsula.ro%2F%3Fprogram'%20and%20compat%3D'html5'%20and%20xpath%3D'%2F%2F*%5B%40class%3D%22bigProgram_container%22%5D'&format=json&diagnostics=true&callback=cbfunc"></script>
	
	<!--
	<script>
		var _gaq = [['_setAccount', 'UA-19824700-1'], ['_trackPageview']];
		(function(d, t) {
			var g = d.createElement(t), s = d.getElementsByTagName(t)[0]; g.async = 1;
			g.src = ('https:' == location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
			s.parentNode.insertBefore(g, s);
		})(document, 'script');
	</script>
	-->
	
</body>
</html>